name: Pull latest release on GitHub
sources:
  newRelease:
    kind: githubrelease
    # name: github version
    spec:
      owner: {{GITHUB_OWNER}}
      repository: {{GITHUB_REPOSITORY}}
      token: "{{ requiredEnv `GITHUB_TOKEN` }}"
      versionfilter:
        kind: regex
        pattern: "v{{GITHUB_REPOSITORY}}-.*$"

conditions:
  checkIfCommitIsNew:
    kind: shell
    sourceid: newRelease
    spec:
      command: /home/pi/code/scripts/compare_with_file.sh /home/pi/code/.last_release_tag

targets:
  runFromRelease:
    kind: shell
    sourceid: newRelease
    spec:
      command: /home/pi/code/scripts/run_from_github_release.sh {{GITHUB_OWNER}} {{GITHUB_REPOSITORY}}
