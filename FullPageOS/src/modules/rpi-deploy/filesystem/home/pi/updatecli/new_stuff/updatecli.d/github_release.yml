name: Pull latest GitHub release if changed
sources:
  githubRelease:
    kind: githubRelease
    name: github version
    spec:
      owner: x
      repository: y
      token: "{{ requiredEnv `GITHUB_TOKEN` }}"
conditions:
  alwaysTrue:
    kind: shell
    spec:
      command: echo "true"
targets:
  fetchBinary:
    kind: shell
    spec:
      command: |
        curl -L -o /opt/updatecli/artifacts/myapp https://github.com/x/y/releases/download/{{ source.githubRelease.version }}/myapp
        chmod +x /opt/updatecli/artifacts/myapp
        ansible-playbook /opt/updatecli/ansible/deploy.yml -e "artifact_name=myapp"
