name: Pull latest release on GitHub
sources:
  newRelease:
    kind: githubrelease
    # name: github version
    spec:
      owner: jamtools
      repository: songdrive-releases
      token: "{{ requiredEnv `GITHUB_TOKEN` }}"
      versionfilter:
        kind: regex
        pattern: "vjamscribe-.*$"

conditions:
  checkIfCommitIsNew:
    kind: shell
    sourceid: newRelease
    spec:
      command: /home/jamtools/code/scripts/compare_with_file.sh /home/jamtools/code/.last_release_tag

targets:
  runFromRelease:
    kind: shell
    sourceid: newRelease
    spec:
      command: /home/jamtools/code/scripts/run_from_github_release.sh jamtools songdrive-releases
